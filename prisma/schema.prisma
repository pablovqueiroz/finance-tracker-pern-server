// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id       String       @id @default(uuid())
  name     String
  email    String       @unique
  password String?
  gender   Gender?
  provider AuthProvider @default(LOCAL)
  googleId String?      @unique

  image         String    @default("https://res.cloudinary.com/dacvtyyst/image/upload/v1769168326/bwcwiefeph34flwiwohy.jpg")
  imagePublicId String?
  accounts      Account[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @default(now()) @updatedAt
}

model Transaction {
  id       String          @id @default(uuid())
  title    String
  amount   Decimal         @db.Decimal(10, 2)
  type     TransactionType
  category String
  date     DateTime        @default(now())

  accountId String
  account   Account @relation(fields: [accountId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@index([accountId])
}

model SavingGoal {
  id            String   @id @default(uuid())
  title         String
  targetAmount  Decimal  @db.Decimal(10,2)
  currentAmount Decimal  @default(0) @db.Decimal(10,2)
  deadline      DateTime?

  accountId String
  account   Account @relation(fields: [accountId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@index([accountId])
}

model Account {
  id       String   @id @default(uuid())
  name     String
  currency Currency @default(EUR)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  transactions Transaction[]
  savingGoals  SavingGoal[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@index([userId])
}

enum TransactionType {
  income
  expense
}

enum AuthProvider {
  LOCAL
  GOOGLE
}

enum Currency {
  EUR
  USD
  BRL
  GBP
  JPY
}

enum Gender {
  male
  female
  non_binary
  trans_man
  trans_woman
  agender
  genderfluid
  prefer_not_to_say
  other
}
